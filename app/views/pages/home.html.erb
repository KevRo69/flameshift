<% unless @warning == "" || @warning.nil? %>
<div class="d-flex justify-content-center align-items-center mt-3">
  <div id="warning">
    <p><%= @warning %></p>
  </div>
</div>
<% end %>

  <div data-controller="filter-weeks" class="filters">
    <div class="filter">
      <select id="month" name="month" data-action="change->filter-weeks#filterWeek" data-filter-weeks-target="week">
        <% @weeks.each_with_index do |week, index| %>
          <% number = week.chars.last %>
          <option value="<%= number %>"
              <%= 'selected' if number == params[:week] || (params[:week].nil? && number == @current_week) %>>
            <%= week %>
          </option>
        <% end %>
      </select>
    </div>
  </div>

<%= render "shared/care", week: params[:week] %>

<div data-controller="sort-cares" class="filters">
  <div class="filter">
    <select id="year" name="year" data-action="change->sort-cares#updateAnnualTable" data-sort-cares-target="year">
      <% (2024..2100).each do |year| %>
        <option value="<%= year %>" <%= 'selected' if year.to_s == params[:year] %>>
          <%= year %>
        </option>
      <% end %>
    </select>
  </div>
  <div class="filter">
    <%= button_to reports_annual_table_pdf_path, method: :post, params: { users: @users.map { |u| { id: u.id, first_name: u.first_name, last_name: u.last_name } },
                                                                          cares_data: @cares_data,
                                                                          maneuvers: @maneuvers,
                                                                          year: params[:year] },
                                                                          data: { turbo: false }, title: "Télécharger le PDF" do %>
      <i class="fa-solid fa-download download-icon fa-xl"></i>
    <% end %>
  </div>
</div>

<h2 style="margin: 20px 20px 0 20px;">Total des gardes (<%= params[:year] %>)</h2>
<div class="table-container table-responsive">
  <table>
    <thead>
      <tr>
        <th>Nom</th>
        <th>Nombre de <br>gardes</th>
        <th>Nombre de <br>vendredis</th>
        <th>Nombre de <br>samedis</th>
        <th>Nombre de <br>dimanches</th>
        <th>Manœuvres</th>
      </tr>
    </thead>
    <tbody>
    <% @users.each do |user| %>
      <% unless user.first_name == "/" %>
        <tr>
          <td><%= user.first_name %><br><%= user.last_name %></td>
          <td><%= @cares_data[user.id][:yearly_cares] %></td>
          <td><%= @cares_data[user.id][:friday_cares] %></td>
          <td><%= @cares_data[user.id][:saturday_cares] %></td>
          <td><%= @cares_data[user.id][:sunday_cares] %></td>
          <td><%= @maneuvers[user.id][:yearly_maneuvers] %></td>
        </tr>
      <% end %>
    <% end %>
    </tbody>
  </table>
</div>
